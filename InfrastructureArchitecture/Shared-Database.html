<!DOCTYPE html>
<html>
<head>
    <title>Infrastructure Architecture Shared Database</title>
    <link rel="stylesheet" href="styles/site.css" type="text/css" />
    <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
    
        <div id="main">
            <div id="main-header">
                <div id="breadcrumb-section">
                    <ol id="breadcrumbs">
                        <li>
                            <a href="index.html">Information Technology</a>
                        </li>
                        <li>
                            <a href="2.0-Architectures_451824369.html">2.0 Architectures</a>
                        </li>
                        <li>
                            <a href="451820182.html">Microservices &amp; Distributed System</a>
                        </li>
                        <li>
                            <a href="Microservice-Architecture_451820190.html">Microservice Architecture</a>
                        </li>
                    </ol>
                </div>
                <h1 id="title-heading" class="pagetitle">

                    Infrastructure Architecture Shared Database

                </h1>
            </div>
            <div id="content" class="view">
                <h2>Context</h2>
                <p>
                    Let’s imagine you are developing an online store application using the 
                    <a href="https://microservices.io/patterns/microservices.html" style="text-decoration: none;" class="external-link" rel="nofollow">Microservice architecture pattern</a>. Most services need to persist data in some kind of database. For example, the 
                    <code class="highlighter-rouge">Order Service</code> stores information about orders and the 
                    <code class="highlighter-rouge">Customer Service</code> stores information about customers.
                </p>
                <p style="margin-left: 30.0px;">
                    <img class="confluence-embedded-image img-responsive confluence-external-resource confluence-content-image-border" height="150" src="https://microservices.io/i/customersandorders.png" data-image-src="https://microservices.io/i/customersandorders.png">
                </p>
                <h2>Problem</h2>
                What’s the database architecture in a microservices application?
                <h2>Forces</h2>
                <ul>
                    <li>
                        <p>Services must be loosely coupled so that they can be developed, deployed and scaled independently</p>
                    </li>
                    <li>
                        <p>
                            Some business transactions must enforce invariants that span multiple services. For example, the 
                            <code class="highlighter-rouge">Place Order</code> use case must verify that a new Order will not exceed the customer’s credit limit. Other business transactions, must update data owned by multiple services.
                        </p>
                    </li>
                    <li>
                        <p>
                            Some business transactions need to query data that is owned by multiple services. For example, the 
                            <code class="highlighter-rouge">View Available Credit</code> use must query the Customer to find the 
                            <code class="highlighter-rouge">creditLimit</code> and Orders to calculate the total amount of the open orders.
                        </p>
                    </li>
                    <li>
                        <p>Some queries must join data that is owned by multiple services. For example, finding customers in a particular region and their recent orders requires a join between customers and orders.</p>
                    </li>
                    <li>
                        <p>
                            Databases must sometimes be replicated and sharded in order to scale. See the 
                            <a style="text-decoration: none;" href="https://microservices.io/articles/scalecube.html" class="external-link" rel="nofollow">Scale Cube</a>.
                        </p>
                    </li>
                    <li>
                        <p>Different services have different data storage requirements. For some services, a relational database is the best choice. Other services might need a NoSQL database such as MongoDB, which is good at storing complex, unstructured data, or Neo4J, which is designed to efficiently store and query graph data.</p>
                    </li>
                </ul>
                <h2>Solution</h2>
                Use a (single) database that is shared by multiple services. Each service freely accesses data owned by other services using local ACID transactions.
                <h2>Examples</h2>
                <h2>Related Context</h2>
                <p>The benefits of this pattern are:</p>
                <ul>
                    <li>A developer uses familiar and straightforward ACID transactions to enforce data consistency</li>
                    <li>A single database is simpler to operate</li>
                </ul>
                <p>The drawbacks of this pattern are:</p>
                <ul>
                    <li>
                        <p>
                            Development time coupling - a developer working on, for example, the 
                            <code class="highlighter-rouge">OrderService</code> will need to coordinate schema changes with the developers of other services that access the same tables. This coupling and additional coordination will slow down development.
                        </p>
                    </li>
                    <li>
                        <p>
                            Runtime coupling - because all services access the same database they can potentially interfere with one another. For example, if long running 
                            <code class="highlighter-rouge">CustomerService</code> transaction holds a lock on the 
                            <code class="highlighter-rouge">ORDER</code> table then the 
                            <code class="highlighter-rouge">OrderService</code> will be blocked.
                        </p>
                    </li>
                    <li>
                        <p>Single database might not satisfy the data storage and access requirements of all services.</p>
                    </li>
                </ul>
            </div>
        </div>
    <div id="footer" role="contentinfo">
        <section class="footer-body">
        </section>
    </div>
</body>
</html>
